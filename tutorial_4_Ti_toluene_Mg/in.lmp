# sample LAMMPS input script for viscosity of 3d LJ liquid
# use shearing wall, thermostat via fix langevin
clear

#-----------settings----------
variable        yhi   equal  25.45
variable        ylo   equal -25.45

variable        t     equal 473.15   # K
variable        pres  index 10000.0  # atm unit, 1 atm = 1 bar = 0.1 MPa
variable        srate equal 2.7/100.0 # shift speed, Angstrom/fs

variable        dt    equal 0.5      # 0.5 fs

#-----------problem setup----------
units           real
atom_style      charge
dimension       3
read_data       data.in
replicate       1 1 1
timestep        ${dt}

mass 1 12.0107  # C
mass 2 1.00794  # H
mass 3 47.867   # Ti
mass 4 924.305  # Mg

# ----- Potential settings -----
pair_style      reax/c lmp_control
pair_coeff      * * ffield.reax.CHONSMgPNaTiClFAu C H Mg Ti
fix             f1 all qeq/reax 1 0.0 10.0 1.0e-6 reax/c

group           upper type 4
group           lower type 3
group           wall union lower upper
group           flow subtract all wall

velocity        flow create $t 97287
velocity        upper set ${srate} 0.0 0.0 units box

compute         thermal flow temp/partial 0 1 0
compute         flow flow temp

# ----- Relax calculation (0 K) -----
#thermo_style    custom step etotal temp lx vol press pxx pyy pxy
#thermo          100
#fix             f2 all box/relax x ${pres} y ${pres} z ${pres}
#minimize        1.0e-10 0.0 10000 100000
#unfix           f2
#reset_timestep  0

#----------equilibration run----------
fix             1 all nve
fix             2 flow langevin $t $t $(200.0*dt) 498094 
fix_modify      2 temp thermal

fix             3 wall setforce 0.0 0.0 0.0

#compute         layers all chunk/atom bin/1d y center 0.05 units reduced
#fix             4 all ave/chunk 20 500 10000 layers vx file profile.wall.3d

#variable        ybox equal $y*ylat
#compute         tilt flow temp/ramp vx 0 ${srate} y 0 ${ybox} units box
compute         tilt flow temp/ramp vx 0 ${srate} y ${ylo} ${yhi} units box

thermo          100
thermo_style    custom step temp c_tilt epair etotal press pxy

dump            d1 all cfg 100 cfg/run1.*.cfg mass type xs ys zs id type q
dump_modify     d1 element C H Mg Ti

run             20000

undump          d1

#----------data gathering run----------
variable        visc equal -pxy/(v_srate/ly)
fix             vave all ave/time 100 1 100 v_visc ave running

thermo_style    custom step temp pxy v_visc f_vave
thermo_modify   temp tilt

dump            d2 all cfg 100 cfg/run2.*.cfg mass type xs ys zs id type q
dump_modify     d2 element C H Mg Ti

run             50000
